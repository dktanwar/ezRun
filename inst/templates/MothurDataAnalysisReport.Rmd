---
title: "`r paste('Mothur data analysis report')`"
author: "Functional Genomics Center Zurich"
output: 
  html_document:
    self_contained: false
    includes:
      in_header: fgcz_header.html
    css: fgcz.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
## This report requires output files form the DataAnalysis App

require(knitr)
require(kableExtra)
require(SummarizedExperiment)
require(webshot)
require(htmlwidgets)
debug <- FALSE
setEnvironments("phantomjs")
```

```{r prepare data, include=FALSE}
### rawDataSummary
rawSummaryTable <- list()
multiTableHeader <- vector()
k=0
for (RawData in RawDataSummary){
  k=k+1
  nameRawFile <- basename(RawData)
  tableTitle <- gsub(".rawSumm.txt","",nameRawFile)
  rawFileDF <- read.delim(nameRawFile, header = T, stringsAsFactors = F)
  rawSummaryTable[[RawData]] <- as.matrix(createSummaryTable(rawFileDF))
  multiTableHeader[tableTitle] <- "6"
}

# deduppedSummary <- createSummaryTable(dedupped)
# deduppedSummaryTable <- deduppedSummary$rawDataSummaryTable
# titleDeduppedSummaryTable<- deduppedSummary$rawDataSummaryTableTitle
# 
# lengthAndHomopFilteredSummary <- createSummaryTable(lengthAndHomopFiltered)
# lengthAndHomopFilteredSummaryTable <- lengthAndHomopFilteredSummary$rawDataSummaryTable
# titleLengthAndHomopFilteredSummaryTable <- lengthAndHomopFilteredSummary$rawDataSummaryTableTitle
# 
# mappedFilteredSummary <- createSummaryTable(mappedFiltered)
# mappedFilteredSummaryTable <- mappedFilteredSummary$rawDataSummaryTable
# titleMappedFilteredSummaryTable <- mappedFilteredSummary$rawDataSummaryTableTitle
# 
# preClusteredAndChimeraFilteredSummary <- createSummaryTable(preClusteredAndChimeraFiltered)
# preClusteredAndChimeraFilteredSummaryTable <- preClusteredAndChimeraFilteredSummary$rawDataSummaryTable
# titlePreClusteredAndChimeraFilteredSummaryTable <- preClusteredAndChimeraFilteredSummary$rawDataSummaryTableTitle
# 
# chimeraPlot <- chimeraSummaryPlot(chimera)
```

Started on `r format(Sys.time(), "%Y-%m-%d %H:%M:%S")`

## Data pre-processing {.tabset}

### Summary of the raw reads
```{r sumIll, echo=FALSE}
ktables <- do.call(cbind, rawSummaryTable)
kable(ktables, escape=TRUE, row.names=FALSE, format="html",
      caption="Summary of raw sequences.") %>%
  kable_styling(bootstrap_options = c("striped", "bordered"),
                full_width = F, position = "left") %>%
  add_header_above(multiTableHeader)
```

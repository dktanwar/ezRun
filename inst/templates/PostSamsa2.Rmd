---
title: "`r if (exists('reportTitle')) reportTitle else 'SUSHI Report'`"
author: "Functional Genomics Center Zurich"
output: 
  html_document:
    self_contained: true
    includes:
     in_header: !expr system.file("templates/fgcz_header.html", package="ezRun", lib.loc=.libPaths())
    css: !expr system.file("templates/fgcz.css", package="ezRun", lib.loc=.libPaths())
editor_options: 
  chunk_output_type: inline
---

    
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=FALSE, message=FALSE, out.width = "49%")
## This report requires the samsa2 output files generated by the Samsa2 App
debug <- FALSE
library(DESeq2)
library(ggplot2)
library(scales)
library(reshape2)
library(knitr)
library(vegan)
```

```{r}
param = readRDS("param.rds")
```

# {.tabset}

## Diversity

### Lineage diversity
```{r engine='bash', comment='', echo=FALSE}
cat org_results/Shannon_Simpson_diversity.txt
```


```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("org_results/diversity_graph.pdf")
```

### Functional diversity
```{r engine='bash', comment='', echo=FALSE}
cat func_results/Shannon_Simpson_diversity.txt
```


```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("func_results/diversity_graph.pdf")
```

## Differences in lineage-level transcript abundance

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("org_results/PCA_plot.tab.pdf")
```

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("org_results/DESeq_heatmap.pdf")
```

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("org_results/combined_graph.pdf")
```

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("org_results/volcano_plot.pdf")
```


```{r echo=FALSE}
table <- read.csv("org_results/DESeq_results.tab", sep = "\t")
table <- table[order(table$log2FoldChange,decreasing=TRUE),]
knitr::kable(table[1:10,])
```


```{r echo=FALSE}
table <- read.csv("org_results/DESeq_results.tab", sep = "\t")
table <- table[table$pvalue < 0.05,]
table <- table[order(table$log2FoldChange),]
knitr::kable(table[1:10,])
```


## Differences in functional-level transcript abundance

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("func_results/PCA_plot.tab.pdf")
```

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("func_results/DESeq_heatmap.pdf")
```

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("func_results/combined_graph.pdf")
```

```{r out.height = "660px", out.width='800px', echo=F}
knitr::include_graphics("func_results/volcano_plot.pdf")
```


```{r echo=FALSE}
table <- read.csv("func_results/DESeq_results.tab", sep = "\t")
table <- table[order(table$log2FoldChange,decreasing=TRUE),]
knitr::kable(table[1:10,])
```


```{r echo=FALSE}
table <- read.csv("func_results/DESeq_results.tab", sep = "\t")
table <- table[table$pvalue < 0.05,]
table <- table[order(table$log2FoldChange),]
knitr::kable(table[1:10,])
```